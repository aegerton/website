---
title: Seen Sam Shipping First Loss 2018-21
author: ''
date: '2018-01-23'
slug: seen-sam-shipping-first-loss-2018-21
categories: []
tags: []
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Monte Carlo Simulation in R

### Preamble

R is a language and environment for statistical computing and graphics. R provides a wide variety of statistical (linear and nonlinear modelling, classical statistical tests, time-series analysis, classification, clustering, …) and graphical techniques, and is highly extensible. R is available as Free Software under the terms of the Free Software Foundation’s GNU General Public License in source code form. For more details, please see <https://www.r-project.org/>.

This analysis makes use of the R package fitdistrplus that provides functions for fitting univariate distributions to different types of data (continuous censored or non-censored data and discrete data) and allowing different estimation methods (maximum likelihood, moment matching, quantile matching and maximum goodness-of-fit estimation).  For more details, please see <http://www.jstatsoft.org/v64/i04/>.

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown, please see <http://rmarkdown.rstudio.com>.


```{r,echo=F,warning=FALSE, error=FALSE, message=FALSE}
## R Packages
library(fitdistrplus)
library(tidyverse)
library(Quandl)
library(readxl)
library(lubridate)
library(knitr)
library(kableExtra)
options(knitr.table.format="html")
```

### Deal Structure

```{r,echo=T}
L <- c(0e6, 25e6, 150e6, 250e6)
GNPI <- c(6e9, 6.5e9, 7e9)
r <- c(0.008333, 0.3)
P <- c(GNPI * r[1])
B <- c(0)
HUL <- c(0.1, 0.2)
lambda <- c(25 / 4, 0)
ROE <- 50
```

```{r,echo=FALSE, warning=FALSE, results='hide'}
Seen_Sam_Consolidated_Incurred_Claims_as_at_311017 <- read_excel(
  "D:/Users/user/Dropbox/AIH Underwriting/Kuwait Re/Seen Sam/Seen Sam - Consolidated Incurred Claims as at 311017.xlsx",
  col_types = c(
    "date", "date", "numeric",
    "date", "date", "text", "text", "text",
    "text", "text", "date", "text", "text",
    "text", "text", "text", "text", "text",
    "text", "text", "text", "text", "text",
    "text", "text"
  )
)
claims <- Seen_Sam_Consolidated_Incurred_Claims_as_at_311017
claims <- claims[-c(1:3), ]
claims <- claims[-c(11:12), ]
claims <- claims[-c(25:26), ]
claims <- claims[-c(57:58), ]
claims <- claims[-c(65:66), ]
colnames(claims) <- Seen_Sam_Consolidated_Incurred_Claims_as_at_311017[2, ]
claims <- claims[, -c(4:5)]
claims <- claims[, -c(5:5)]
claims <- claims[, -c(17:17)]
claims <- claims[, -c(18:18)]
claims <- claims[, -c(19:19)]
claims$`100% Claims Paid (OC)` <- as.numeric(claims$`100% Claims Paid (OC)`)
claims$`100% Total OSLR (OC)` <- as.numeric(claims$`100% Total OSLR (OC)`)
claims$`100% Claims Incurred (OC)` <- as.numeric(claims$`100% Claims Incurred (OC)`)
colnames(claims) <- c("Inception", "Expiry", "Policy", "Claim", "Fleet", "Vessel", "Type", "DOL", "LAE", "Class", "Order", "Facility", "Year", "ROE", "CURR", "Paid", "OSLR", "Incurred", "Status")
claims$ROE <- as.numeric(claims$ROE)
claims$Incurred <- claims$Incurred * claims$ROE * ROE
agg <- claims %>%
  group_by(DOL) %>%
  summarise(loss = sum(Incurred)) %>%
  arrange(loss)
agg <- agg[-c(1:9), ]
agg <- agg %>%
  arrange(DOL)
agg$DOL <- year(agg$DOL)
Quandl.api_key("UFb4zZy9Minr72EAQfu_")
philcpidata <- Quandl("ODA/PHL_PCPIE", type = "ts", start_date = "2012-01-01")
CPI <- philcpidata[1:5]
DOL <- c(2013, 2014, 2015, 2016, 2017)
CPI <- cbind(DOL, CPI)
agg <- merge(agg, CPI, ID = "DOL")
agg <- as.tibble(agg)
agg <- agg %>%
  mutate(inflate = loss * CPI[25] / CPI, limit = pmin(inflate, L[2]), excess = inflate - limit) %>%
  arrange(desc(inflate))
agg %>%
  group_by(DOL) %>%
  summarise(xs = sum(excess))
fln <- fitdist(agg$inflate, "lnorm")
```

### Loss Severity Distribution Fit

```{r,echo=FALSE}
print(summary(fln))
```


```{r,echo=F}
## Code
n <- 10000
sev <- function(x) {pmax(sum(pmin(L[2], pmax(rlnorm(x, fln$estimate[1], fln$estimate[2]) - L[1], 0)))-L[1],0)}
freq <- as.tibble(t(replicate(n, rpois(3, lambda[1]))))
loss <- apply(freq, c(1, 2), sev)
colnames(loss) <- c("2018", "2019", "2020")
y <- philcpidata[c(6:8)] / philcpidata[5]
inflate <- function(x){(x*y)}
inflated.loss <- as.tibble(t(apply(loss,1,inflate)))
inflated.loss[inflated.loss>L[3]] <- L[3]
total.loss <- transmute(inflated.loss, sum = (inflated.loss$'2018'+inflated.loss$'2019'+inflated.loss$'2020'))
total.loss$sum[total.loss$sum>L[4]] <- L[4]
total.loss <- as.vector(total.loss$sum)
total.premium <- c(1:n)
total.premium[c(1:n)] <- sum(P)
total <- data.frame(total.premium, total.loss)
atr <- as.tibble(total)/ROE
colnames(atr) <- c("total.premium", "total.loss")
atr <- atr %>%
  mutate(broker = sum(P) * r[2] * B / ROE,
  HUL.commission = sum(P) * r[2] * HUL[1] / ROE,
  profit = total.premium - total.loss - broker - HUL.commission,
  margin = pmin(sum(P) * r[2] * (1 - HUL[1] - B) / ROE, pmax(0, profit)),
  HUL.profit = margin * HUL[2],
  net.margin = margin - HUL.profit,
  NPV = pmin(net.margin, profit)
)
```

### Output

```{r,echo=F}
atr.loss <- filter(atr, NPV < 0)
atr.profit <- filter(atr, NPV >= 0)

## summary(atr)
## (((-mean(atr$net.result)/quantile(atr$net.result,0.01))+1)^(1/2.5))-1

df <- c("Average NPV", "Avg NPV / ERD", "Maximum NPV", "Average NPV in Profit Cases", "Minimum NPV", "Probability of Loss", "Average Loss in Loss Cases", "Avg Loss in Loss Cases / Avg Prem", "ERD / Avg Prem", "99th Percentile Loss", "99th Percentile Leverage", "ARC", "Spread on Face Capital", "Total Return on ARC", "Avg Life of ARC (estimated)", "Annual Return on ARC")
df <- data.frame(df)
df$USD <- 0
df$USD[1] <- round(mean(atr$NPV))
df$USD[6] <- round(sum(atr$NPV < 0) / n, 2)
df$USD[7] <- round(sum(atr.loss$NPV) / sum(atr$NPV < 0))
df$USD[2] <- abs(round(df$USD[1] / (df$USD[6] * df$USD[7]), 2))
df$USD[3] <- round(max(atr$NPV))
df$USD[5] <- round(min(atr$NPV))
df$USD[10] <- round(quantile(atr$NPV, 0.01))
df$USD[4] <- round(sum(atr.profit$NPV) / sum(atr$NPV >= 0))
df$USD[8] <- abs(round(df$USD[7] / (mean(atr$total.premium)), 2))
df$USD[9] <- abs(round(df$USD[6] * df$USD[7] / (mean(atr$total.premium)), 2))
df$USD[11] <- round(abs(df$USD[10] / df$USD[1]), 2)
df$USD[13] <- 0.01
df$USD[12] <- round(((-df$USD[10] + df$USD[1]) * 0.5) - df$USD[1] + (df$USD[13] * (max(atr$total.loss) - mean(atr$total.premium))))
df$USD[14] <- round(df$USD[1] / df$USD[12], 2)
df$USD[15] <- 2.5
df$USD[16] <- round((df$USD[14] + 1) ^ (1 / df$USD[15]) - 1, 2)
## plotdist(atr$NPV, demp = T, col="blue", pch=16)
atr1 <- select(atr, total.premium, total.loss)
summary(atr1)%>%
  kable("html", escape = F)%>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), font_size = 14, full_width = F, position = "left")
## print(df)
df%>%
  kable("html", escape = F)%>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), font_size = 14, full_width = F, position = "left")
```

### NPV Plots

```{r, echo=FALSE}
plotdist(atr$NPV, demp = T, col = "blue", pch = 16)
```

### Disclaimer

The results in this report are strictly private and confidential. 

Developing models to estimate losses is an inherently subjective and imprecise process, involving judgment about a variety of environmental, demographic and regulatory factors. Alternative assumptions and methodologies could yield materially different results. Also, the output of the models depends on data and inputs supplied by others, and any gaps, inaccuracies, or changes to the inputs can substantially affect the output. 

The model output in this report consists of estimates, not predictions. Actual experience may differ materially. There are no guarantees about the reliability, accuracy or completeness of the model output and Huntington Underwriting Limited assumes no liability or responsibility for the content of this report whatsoever.

```{r, echo=FALSE}

```
_________________________________________________________________________________________
##### **HUNTINGTON UNDERWRITING LIMITED**				       <http://www.huntingtonunderwriting.com>
Brighton Place, Ground Floor, U0215, Jalan Bahasa, PO Box 80431, 87014 Labuan FT, Malaysia   
Tel: +60 87 442899  
A Licensed Labuan Underwriting Manager under the Labuan Financial Services & Securities Act 2010 
(# US201226)


 


